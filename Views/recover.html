s<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Datastream-Send</title>

          <!--Bootstrap icons-->
    <link href="/assets/fonts/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">

<!--Google web fonts-->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital@0;1&family=Open+Sans:wght@300..800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,0,0" />
        <link rel="stylesheet" href="/assets/css/style.min.css">
        <style>
                        #BuTtOn{
                background: linear-gradient(90.24deg, #0A77B8 0.21%, #0FB3D8 99.82%);
            }
            .invalid-feedback { color: red; display: none; }

        </style>
    </head>

    <body>

        <!--Theme mode switcher-->
        <div class="position-absolute end-0 top-0 size-40 me-2 mt-2 z-index-fixed">
            <label class="dark-mode-checkbox size-40 d-flex align-items-center justify-content-center nav-link p-0" for="ChangeTheme">
                <input type="checkbox" id="ChangeTheme"/> <span class="slide"></span>
                </label>
        </div>

        
       <!--////////////////// PreLoader Start//////////////////////-->
  <div class="loader bg-gradient-primary text-white">
    <!--Placeholder animated layout for preloader-->
    <div class="d-flex flex-column flex-root">
      <div class="page d-flex flex-row flex-column-fluid">
        <div class="page-content ps-0 ms-0 d-flex flex-column flex-row-fluid">
          <div
            class="content flex-column p-4 pb-0 d-flex justify-content-center align-items-center flex-column-fluid position-relative">
            <div class="w-100 h-100 position-relative d-flex align-items-center justify-content-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-loader anim-spinner me-2"><line x1="12" y1="2" x2="12" y2="6"/><line x1="12" y1="18" x2="12" y2="22"/><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"/><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"/><line x1="2" y1="12" x2="6" y2="12"/><line x1="18" y1="12" x2="22" y2="12"/><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"/><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"/></svg>
            <div>
              <span>Loading...</span>
            </div>
          </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!--////////////////// /.PreLoader END//////////////////////-->

        <div class="d-flex flex-column flex-root">
            <!--Page-->
            <div class="page d-flex flex-row flex-column-fluid">
                
                <!--///////////Page content wrapper///////////////-->
                <main class="page-content overflow-hidden ms-0 d-flex flex-column flex-row-fluid">

                    <div class="content p-1 d-flex flex-column-fluid position-relative vh-50">
                        <div class="container h-100">
                            <div class="row h-100 align-items-center justify-content-center">
                                <div class="col-md-8 col-lg-5 col-xl-4">
                                    <!-- Logo -->
                                    <a href="/" class="d-flex mb-4 align-items-center justify-content-center">
                                        <img src="/assets/media/WPcodersProfile.png" alt="Logo" width="100" height="60">
                                    </a>
                    
                                    <!-- Card -->
                                    <div class="card card-body p-4">
                                        <!-- Toast -->
                                        <div id="toastContainer" class="position-fixed bottom-0 end-0 p-3" style="z-index: 1055;"></div>
                    
                                        <!-- Forgot Password Form -->
                                        <form class="position-relative needs-validation" id="LoginForm" novalidate>
                                            <div id="emailField">
                                                <div class="form-floating mb-3">
                                                    <input type="email" class="form-control" name="Email" id="floatingInputEmail"
                                                        placeholder="name@example.com" required>
                                                    <label for="floatingInputEmail">Email address</label>
                                                    <span class="invalid-feedback" id="emailError">Please enter a valid email address</span>
                                                </div>
                                                <button class="w-100 btn btn-lg btn-primary" id="forgotPasswordButton" type="submit">
                                                    Submit
                                                </button>
                                            </div>
                    
                                            <!-- Temporary Password Field (Initially Hidden) -->
                                            <div id="tempPasswordField" style="display: none;">
                                                <div class="form-floating mb-3">
                                                    <input type="password" class="form-control" id="tempPasswordInput" placeholder="Enter Temporary Password" required>
                                                    <label for="tempPasswordInput">Temporary Password</label>
                                                    <span class="invalid-feedback" id="tempPasswordError">Please enter a valid temporary password</span>
                                                </div>
                                                <button class="w-100 btn btn-lg btn-primary" id="tempPasswordButton" type="button">
                                                    Submit Temporary Password
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <script>
                        let userEmail = ''; // Store the email for later use
                    
                        // Form submission handler for email
                        document.getElementById('LoginForm').addEventListener('submit', async function (event) {
                            event.preventDefault(); // Prevent page reload
                    
                            const emailInput = document.getElementById('floatingInputEmail');
                            const emailError = document.getElementById('emailError');
                            const email = emailInput.value.trim();
                            const emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
                    
                            // Clear any previous error messages
                            emailError.style.display = 'none';
                    
                            // Validate email
                            if (!emailPattern.test(email)) {
                                emailError.style.display = 'block';
                                emailInput.focus();
                                return;
                            }
                    
                            // Store the email for later use and attempt to recover password
                            userEmail = email;
                            await recoverPassword(email);
                        });
                    
                        // Function to handle password recovery
                        async function recoverPassword(email) {
                            try {
                                const response = await fetch('/recoverpass', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                    },
                                    body: JSON.stringify({ email }),
                                });
                    
                                if (response.ok) {
                                    const data = await response.json();
                                    showToast(`Success: ${data.message}`, true);
                    
                                    // Hide email field and show temporary password field
                                    document.getElementById('emailField').style.display = 'none';
                                    document.getElementById('tempPasswordField').style.display = 'block';
                                } else {
                                    const errorMessage = await response.text();
                                    showToast(`Error: ${errorMessage}`, false);
                                }
                            } catch (error) {
                                showToast('An unexpected error occurred. Please try again.', false);
                            }
                        }
                    
                        // Submit temporary password with the stored email
                        document.getElementById('tempPasswordButton').addEventListener('click', async function () {
                            const tempPasswordInput = document.getElementById('tempPasswordInput');
                            const tempPasswordError = document.getElementById('tempPasswordError');
                            const tempPassword = tempPasswordInput.value.trim();
                    
                            // Clear previous error
                            tempPasswordError.style.display = 'none';
                    
                            // Validate temporary password
                            if (!tempPassword) {
                                tempPasswordError.style.display = 'block';
                                tempPasswordInput.focus();
                                return;
                            }
                    
                            // Send email and temporary password to /tempassauth route
                            await authenticateTempPassword(userEmail, tempPassword);
                        });
                    
                        // Function to authenticate temporary password with email
                        async function authenticateTempPassword(email, tempPassword) {
    try {
        const response = await fetch('/tempassauth', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email, tempPassword }),
        });

        if (response.ok) {
            const data = await response.json();
            showToast(data.message, true); // Success message from backend

            // Optional: Redirect after successful authentication
            setTimeout(() => {
                window.location.href = "/"; // Redirect to change password page
            }, 2000);
        } else {
            const errorMessage = await response.text();
            showToast(errorMessage, false); // Error messages from backend
        }
    } catch (error) {
        showToast('An unexpected error occurred. Please try again.', false);
    }
}
                 
                        // Function to display toast messages
                        function showToast(message, isSuccess) {
                            const toastElement = document.createElement('div');
                            toastElement.className = `toast align-items-center text-white ${isSuccess ? 'bg-success' : 'bg-danger'} border-0`;
                            toastElement.role = 'alert';
                            toastElement.innerHTML = `
                                <div class="d-flex">
                                    <div class="toast-body">
                                        ${message}
                                    </div>
                                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                                </div>
                            `;
                    
                            // Append and display the toast
                            document.getElementById('toastContainer').appendChild(toastElement);
                            const toast = new bootstrap.Toast(toastElement);
                            toast.show();
                    
                            // Remove toast after hidden
                            toastElement.addEventListener('hidden.bs.toast', () => {
                                toastElement.remove();
                            });
                        }
                    </script>
                    
                    
                    
                    

                    <!--///////////Page content wrapper end///////////////-->

      <!--//Page-footer//-->
 <footer class="pb-3 pb-lg-5 px-3 px-lg-6">
    <div class="container-fluid px-0">
      <span class="d-block lh-sm small text-muted text-end">&copy;
        <script>
          document.write(new Date().getFullYear())
        </script>. Copyright
      </span>
    </div>
  </footer>
  <!--/.Page Footer End-->

                </main>
            </div>
        </div>
 
<!--////////////Theme Core scripts Start/////////////////-->
<script src="/assets/js/theme.bundle.js"></script>

<!--////////////Theme Core scripts End/////////////////-->

    </body>

</html>
